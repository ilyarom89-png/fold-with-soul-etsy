<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fold With Soul Calculator — Heart</title>
<style>
:root {
  --bg:#070b13;
  --panel: rgba(20,28,46,.68);
  --panel2: rgba(14,20,34,.68);
  --stroke: rgba(255,255,255,.10);
  --stroke2: rgba(255,255,255,.16);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.70);
  --muted2: rgba(255,255,255,.55);
  --accent: rgba(120,170,255,.95);
  --good: rgba(90,210,150,.95);
  --bad: rgba(255,120,120,.95);
  --shadow: 0 30px 90px rgba(0,0,0,.55);
  --radius: 18px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--text);
  background:
    radial-gradient(900px 500px at 20% 10%, rgba(90,130,255,.20), transparent 60%),
    radial-gradient(900px 500px at 75% 20%, rgba(255,255,255,.10), transparent 55%),
    radial-gradient(900px 600px at 60% 85%, rgba(60,150,255,.16), transparent 60%),
    linear-gradient(180deg, var(--bg), #04060c 70%);
  min-height:100vh;
}

.wrap{max-width:1180px; margin:36px auto; padding:0 18px}
.header{
  background: linear-gradient(180deg, rgba(30,46,78,.75), rgba(10,14,24,.45));
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  padding:22px 22px 18px;
  box-shadow: var(--shadow);
}
.h1row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
h1{margin:0; font-size:28px; font-weight:750; letter-spacing:.2px}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.06);
  color:var(--muted);
  font-size:12px;
}
.sub{margin-top:8px; color:var(--muted); font-size:13.5px; line-height:1.45}
.grid{display:grid; grid-template-columns: 420px 1fr; gap:18px; margin-top:18px}
@media (max-width: 980px){ .grid{grid-template-columns:1fr;} }

.card{
  background: linear-gradient(180deg, var(--panel), var(--panel2));
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
.card .inner{padding:18px}
.label{font-size:12px; color:var(--muted); margin-bottom:8px}
input, select, button{
  font: inherit;
}
input, select{
  width:100%;
  padding:12px 12px;
  border-radius: 12px;
  border:1px solid var(--stroke2);
  background: rgba(0,0,0,.25);
  color: var(--text);
  outline: none;
}
input::placeholder{color: rgba(255,255,255,.35)}

.row{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
.kpi{
  padding:12px 12px;
  border-radius: 14px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.05);
}
.kpi .k{font-size:12px; color:var(--muted2)}
.kpi .v{font-size:18px; margin-top:6px; font-weight:740}

.btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
button{
  border-radius: 14px;
  border:1px solid var(--stroke2);
  background: rgba(255,255,255,.06);
  color: var(--text);
  padding:10px 14px;
  cursor:pointer;
  font-weight:650;
}
button.primary{background: rgba(120,170,255,.18); border-color: rgba(120,170,255,.35)}
button:active{transform: translateY(1px)}
small.hint{display:block; margin-top:10px; color:var(--muted2); line-height:1.4}
.status{float:right; color: var(--muted2); font-size:12px; margin-top:2px}
.msg{margin-top:10px; padding:10px 12px; border-radius: 12px; border:1px solid var(--stroke); background: rgba(255,255,255,.05); color: var(--muted); font-size:13px}
.msg.bad{border-color: rgba(255,120,120,.35); background: rgba(255,120,120,.08); color: rgba(255,220,220,.95)}
.msg.good{border-color: rgba(90,210,150,.35); background: rgba(90,210,150,.08); color: rgba(210,255,235,.95)}

.tableTop{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:16px 18px 10px}
.tableTop .left{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
.tablewrap{padding:0 18px 18px}
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  overflow:hidden;
  border-radius: 14px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.18);
}
thead th{
  text-align:left;
  font-size:12px;
  color: var(--muted);
  padding:12px 12px;
  border-bottom:1px solid var(--stroke);
  position:sticky; top:0;
  background: rgba(10,14,24,.78);
  backdrop-filter: blur(8px);
}
tbody td{
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.06);
  color: rgba(255,255,255,.88);
  font-variant-numeric: tabular-nums;
}
tbody tr:last-child td{border-bottom:none}
.badge{
  display:inline-flex; align-items:center; gap:7px;
  padding:6px 10px; border-radius:999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.05);
  color: var(--muted);
  font-size:12px;
}
.note{margin-top:8px; color: var(--muted2); font-size:12.5px}
@media print {
  body{background:#fff; color:#000}
  .wrap{margin:0; max-width:none; padding:0}
  .header, .card{box-shadow:none}
  .grid{grid-template-columns:1fr}
  .btnrow, .tableTop button, .status, .note{display:none !important}
  .header{border:none; background:#fff}
  .card{border:none; background:#fff}
  table{border:1px solid #aaa}
  thead th{background:#f4f4f4; color:#000}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="h1row">
      <h1>Fold With Soul Calculator — Heart</h1>
      <span class="pill" id="pillHeight">19 cm</span>
      <span class="pill">MMF (Measure • Mark • Fold)</span>
      <span class="pill">No cutting • No glue</span>
    </div>
    <div class="sub">
      Choose your book height (19 / 21 / 23 cm). The design is always centered. This Heart pattern requires <b>180 folds</b> (= <b>360 numbered pages</b>).<br/>
      We fold on odd pages only: 1, 3, 5… The calculator picks the correct start page automatically.
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="inner">
        <div class="label">Book height</div>
        <select id="heightSel">
          <option value="19" selected>19 cm (ready)</option>
          <option value="21" disabled>21 cm (coming soon)</option>
          <option value="23" disabled>23 cm (coming soon)</option>
        </select>

        <div style="height:12px"></div>
        <div class="label">My book total pages (required, min 360)</div>
        <input id="bookPages" inputmode="numeric" placeholder="e.g., 389" />

        <div style="height:12px"></div>
        <div class="row">
          <div class="kpi">
            <div class="k">Total folds</div>
            <div class="v" id="kFolds">180</div>
          </div>
          <div class="kpi">
            <div class="k">Pages needed</div>
            <div class="v" id="kPagesNeeded">360</div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="row">
          <div class="kpi">
            <div class="k">Start page (odd)</div>
            <div class="v" id="kStart">—</div>
          </div>
          <div class="kpi">
            <div class="k">End page</div>
            <div class="v" id="kEnd">—</div>
          </div>
        </div>

        <div class="btnrow">
          <button class="primary" id="applyBtn">Apply</button>
          <button id="resetBtn">Reset</button>
        </div>

        <div id="msg" class="msg">Enter your book page count and press <b>Apply</b>.</div>
        <small class="hint">
          Tip: When printing to PDF, set margins to <b>Default</b> (or <b>None</b>) and enable background graphics if your browser has that option.
        </small>
      </div>
    </div>

    <div class="card">
      <div class="tableTop">
        <div class="left">
          <button class="primary" id="printBtn">Save as PDF / Print</button>
          <button id="dlBtn">Download table (CSV)</button>
          <span class="badge" id="badgeReady">Ready</span>
        </div>
        <div class="status" id="status">Waiting for input…</div>
      </div>
      <div class="tablewrap">
        <table>
          <thead>
            <tr>
              <th style="width:90px">FOLD</th>
              <th style="width:120px">PAGE (ODD)</th>
              <th style="width:140px">MARK 1 (CM)</th>
              <th style="width:140px">MARK 2 (CM)</th>
            </tr>
          </thead>
          <tbody id="tbody">
          </tbody>
        </table>
        <div class="note">
          The table is generated from the official Heart pattern CSV (19 cm). Marks are in centimeters.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const PATTERN_19 = [{"fold": 1, "m1": 5.6, "m2": 6.4}, {"fold": 2, "m1": 5.1, "m2": 6.9}, {"fold": 3, "m1": 4.9, "m2": 7.2}, {"fold": 4, "m1": 4.7, "m2": 7.4}, {"fold": 5, "m1": 4.6, "m2": 7.6}, {"fold": 6, "m1": 4.4, "m2": 7.8}, {"fold": 7, "m1": 4.3, "m2": 8.0}, {"fold": 8, "m1": 4.2, "m2": 8.1}, {"fold": 9, "m1": 4.1, "m2": 8.3}, {"fold": 10, "m1": 4.0, "m2": 8.4}, {"fold": 11, "m1": 3.9, "m2": 8.5}, {"fold": 12, "m1": 3.9, "m2": 8.6}, {"fold": 13, "m1": 3.8, "m2": 8.8}, {"fold": 14, "m1": 3.7, "m2": 8.9}, {"fold": 15, "m1": 3.6, "m2": 9.0}, {"fold": 16, "m1": 3.6, "m2": 9.1}, {"fold": 17, "m1": 3.5, "m2": 9.2}, {"fold": 18, "m1": 3.5, "m2": 9.3}, {"fold": 19, "m1": 3.4, "m2": 9.4}, {"fold": 20, "m1": 3.4, "m2": 9.5}, {"fold": 21, "m1": 3.3, "m2": 9.6}, {"fold": 22, "m1": 3.3, "m2": 9.7}, {"fold": 23, "m1": 3.2, "m2": 9.8}, {"fold": 24, "m1": 3.2, "m2": 9.9}, {"fold": 25, "m1": 3.1, "m2": 10.0}, {"fold": 26, "m1": 3.1, "m2": 10.1}, {"fold": 27, "m1": 3.1, "m2": 10.2}, {"fold": 28, "m1": 3.0, "m2": 10.3}, {"fold": 29, "m1": 3.0, "m2": 10.4}, {"fold": 30, "m1": 3.0, "m2": 10.4}, {"fold": 31, "m1": 2.9, "m2": 10.5}, {"fold": 32, "m1": 2.9, "m2": 10.6}, {"fold": 33, "m1": 2.9, "m2": 10.7}, {"fold": 34, "m1": 2.9, "m2": 10.8}, {"fold": 35, "m1": 2.9, "m2": 10.9}, {"fold": 36, "m1": 2.8, "m2": 10.9}, {"fold": 37, "m1": 2.8, "m2": 11.0}, {"fold": 38, "m1": 2.8, "m2": 11.1}, {"fold": 39, "m1": 2.8, "m2": 11.2}, {"fold": 40, "m1": 2.8, "m2": 11.3}, {"fold": 41, "m1": 2.8, "m2": 11.4}, {"fold": 42, "m1": 2.8, "m2": 11.5}, {"fold": 43, "m1": 2.8, "m2": 11.5}, {"fold": 44, "m1": 2.8, "m2": 11.6}, {"fold": 45, "m1": 2.7, "m2": 11.7}, {"fold": 46, "m1": 2.7, "m2": 11.8}, {"fold": 47, "m1": 2.7, "m2": 11.9}, {"fold": 48, "m1": 2.7, "m2": 11.9}, {"fold": 49, "m1": 2.7, "m2": 12.0}, {"fold": 50, "m1": 2.7, "m2": 12.1}, {"fold": 51, "m1": 2.7, "m2": 12.2}, {"fold": 52, "m1": 2.8, "m2": 12.3}, {"fold": 53, "m1": 2.8, "m2": 12.4}, {"fold": 54, "m1": 2.8, "m2": 12.5}, {"fold": 55, "m1": 2.8, "m2": 12.5}, {"fold": 56, "m1": 2.8, "m2": 12.6}, {"fold": 57, "m1": 2.8, "m2": 12.7}, {"fold": 58, "m1": 2.8, "m2": 12.8}, {"fold": 59, "m1": 2.8, "m2": 12.9}, {"fold": 60, "m1": 2.8, "m2": 13.0}, {"fold": 61, "m1": 2.9, "m2": 13.1}, {"fold": 62, "m1": 2.9, "m2": 13.2}, {"fold": 63, "m1": 2.9, "m2": 13.3}, {"fold": 64, "m1": 2.9, "m2": 13.4}, {"fold": 65, "m1": 3.0, "m2": 13.4}, {"fold": 66, "m1": 3.0, "m2": 13.5}, {"fold": 67, "m1": 3.0, "m2": 13.7}, {"fold": 68, "m1": 3.1, "m2": 13.7}, {"fold": 69, "m1": 3.1, "m2": 13.8}, {"fold": 70, "m1": 3.1, "m2": 13.9}, {"fold": 71, "m1": 3.2, "m2": 14.0}, {"fold": 72, "m1": 3.2, "m2": 14.1}, {"fold": 73, "m1": 3.3, "m2": 14.2}, {"fold": 74, "m1": 3.3, "m2": 14.3}, {"fold": 75, "m1": 3.4, "m2": 14.4}, {"fold": 76, "m1": 3.4, "m2": 14.6}, {"fold": 77, "m1": 3.5, "m2": 14.6}, {"fold": 78, "m1": 3.6, "m2": 14.8}, {"fold": 79, "m1": 3.6, "m2": 14.9}, {"fold": 80, "m1": 3.7, "m2": 15.0}, {"fold": 81, "m1": 3.8, "m2": 15.1}, {"fold": 82, "m1": 3.9, "m2": 15.2}, {"fold": 83, "m1": 4.0, "m2": 15.4}, {"fold": 84, "m1": 4.1, "m2": 15.5}, {"fold": 85, "m1": 4.2, "m2": 15.6}, {"fold": 86, "m1": 4.3, "m2": 15.8}, {"fold": 87, "m1": 4.4, "m2": 15.9}, {"fold": 88, "m1": 4.6, "m2": 16.1}, {"fold": 89, "m1": 4.7, "m2": 16.2}, {"fold": 90, "m1": 4.8, "m2": 16.3}, {"fold": 91, "m1": 4.8, "m2": 16.3}, {"fold": 92, "m1": 4.7, "m2": 16.2}, {"fold": 93, "m1": 4.6, "m2": 16.1}, {"fold": 94, "m1": 4.4, "m2": 15.9}, {"fold": 95, "m1": 4.3, "m2": 15.8}, {"fold": 96, "m1": 4.2, "m2": 15.6}, {"fold": 97, "m1": 4.1, "m2": 15.5}, {"fold": 98, "m1": 4.0, "m2": 15.4}, {"fold": 99, "m1": 3.9, "m2": 15.2}, {"fold": 100, "m1": 3.8, "m2": 15.1}, {"fold": 101, "m1": 3.7, "m2": 15.0}, {"fold": 102, "m1": 3.6, "m2": 14.9}, {"fold": 103, "m1": 3.6, "m2": 14.8}, {"fold": 104, "m1": 3.5, "m2": 14.6}, {"fold": 105, "m1": 3.4, "m2": 14.6}, {"fold": 106, "m1": 3.4, "m2": 14.4}, {"fold": 107, "m1": 3.3, "m2": 14.3}, {"fold": 108, "m1": 3.3, "m2": 14.2}, {"fold": 109, "m1": 3.2, "m2": 14.1}, {"fold": 110, "m1": 3.2, "m2": 14.0}, {"fold": 111, "m1": 3.1, "m2": 13.9}, {"fold": 112, "m1": 3.1, "m2": 13.8}, {"fold": 113, "m1": 3.1, "m2": 13.7}, {"fold": 114, "m1": 3.0, "m2": 13.7}, {"fold": 115, "m1": 3.0, "m2": 13.5}, {"fold": 116, "m1": 3.0, "m2": 13.4}, {"fold": 117, "m1": 2.9, "m2": 13.4}, {"fold": 118, "m1": 2.9, "m2": 13.3}, {"fold": 119, "m1": 2.9, "m2": 13.2}, {"fold": 120, "m1": 2.9, "m2": 13.1}, {"fold": 121, "m1": 2.8, "m2": 13.0}, {"fold": 122, "m1": 2.8, "m2": 12.9}, {"fold": 123, "m1": 2.8, "m2": 12.8}, {"fold": 124, "m1": 2.8, "m2": 12.7}, {"fold": 125, "m1": 2.8, "m2": 12.6}, {"fold": 126, "m1": 2.8, "m2": 12.5}, {"fold": 127, "m1": 2.8, "m2": 12.5}, {"fold": 128, "m1": 2.8, "m2": 12.4}, {"fold": 129, "m1": 2.8, "m2": 12.3}, {"fold": 130, "m1": 2.7, "m2": 12.2}, {"fold": 131, "m1": 2.7, "m2": 12.1}, {"fold": 132, "m1": 2.7, "m2": 12.0}, {"fold": 133, "m1": 2.7, "m2": 11.9}, {"fold": 134, "m1": 2.7, "m2": 11.9}, {"fold": 135, "m1": 2.7, "m2": 11.8}, {"fold": 136, "m1": 2.7, "m2": 11.7}, {"fold": 137, "m1": 2.8, "m2": 11.6}, {"fold": 138, "m1": 2.8, "m2": 11.5}, {"fold": 139, "m1": 2.8, "m2": 11.5}, {"fold": 140, "m1": 2.8, "m2": 11.4}, {"fold": 141, "m1": 2.8, "m2": 11.3}, {"fold": 142, "m1": 2.8, "m2": 11.2}, {"fold": 143, "m1": 2.8, "m2": 11.1}, {"fold": 144, "m1": 2.8, "m2": 11.0}, {"fold": 145, "m1": 2.8, "m2": 10.9}, {"fold": 146, "m1": 2.9, "m2": 10.9}, {"fold": 147, "m1": 2.9, "m2": 10.8}, {"fold": 148, "m1": 2.9, "m2": 10.7}, {"fold": 149, "m1": 2.9, "m2": 10.6}, {"fold": 150, "m1": 2.9, "m2": 10.5}, {"fold": 151, "m1": 3.0, "m2": 10.4}, {"fold": 152, "m1": 3.0, "m2": 10.4}, {"fold": 153, "m1": 3.0, "m2": 10.3}, {"fold": 154, "m1": 3.1, "m2": 10.2}, {"fold": 155, "m1": 3.1, "m2": 10.1}, {"fold": 156, "m1": 3.1, "m2": 10.0}, {"fold": 157, "m1": 3.2, "m2": 9.9}, {"fold": 158, "m1": 3.2, "m2": 9.8}, {"fold": 159, "m1": 3.3, "m2": 9.7}, {"fold": 160, "m1": 3.3, "m2": 9.6}, {"fold": 161, "m1": 3.4, "m2": 9.5}, {"fold": 162, "m1": 3.4, "m2": 9.4}, {"fold": 163, "m1": 3.5, "m2": 9.3}, {"fold": 164, "m1": 3.5, "m2": 9.2}, {"fold": 165, "m1": 3.6, "m2": 9.1}, {"fold": 166, "m1": 3.6, "m2": 9.0}, {"fold": 167, "m1": 3.7, "m2": 8.9}, {"fold": 168, "m1": 3.8, "m2": 8.8}, {"fold": 169, "m1": 3.9, "m2": 8.6}, {"fold": 170, "m1": 3.9, "m2": 8.5}, {"fold": 171, "m1": 4.0, "m2": 8.4}, {"fold": 172, "m1": 4.1, "m2": 8.3}, {"fold": 173, "m1": 4.2, "m2": 8.1}, {"fold": 174, "m1": 4.3, "m2": 8.0}, {"fold": 175, "m1": 4.4, "m2": 7.8}, {"fold": 176, "m1": 4.6, "m2": 7.6}, {"fold": 177, "m1": 4.7, "m2": 7.4}, {"fold": 178, "m1": 4.9, "m2": 7.2}, {"fold": 179, "m1": 5.1, "m2": 6.9}, {"fold": 180, "m1": 5.6, "m2": 6.4}];

const REQUIRED_FOLDS = 180;
const REQUIRED_NUMBERED_PAGES = 360; // fixed rule from FWS
const ODD_SPAN = (REQUIRED_FOLDS - 1) * 2; // 358

function toInt(v) {
  const n = Number(String(v).replace(/[^0-9]/g,''));
  return Number.isFinite(n) ? Math.trunc(n) : NaN;
}

function setMsg(type, text) {
  const el = document.getElementById('msg');
  el.className = 'msg' + (type ? ' ' + type : '');
  el.innerHTML = text;
}

function clearTable() {
  document.getElementById('tbody').innerHTML = '';
}

function renderTable(startOdd) {
  const tbody = document.getElementById('tbody');
  const rows = PATTERN_19;
  tbody.innerHTML = '';
  for (let i = 0; i < rows.length; i++) {
    const pageOdd = startOdd + i*2;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${rows[i].fold}</td>
      <td>${pageOdd}</td>
      <td>${rows[i].m1.toFixed(1)}</td>
      <td>${rows[i].m2.toFixed(1)}</td>
    `;
    tbody.appendChild(tr);
  }
}

function computeCenteredStart(bookPages) {
  // Pattern occupies 180 odd pages -> numbered pages span of 358 from start to end
  // We center by distributing "extra pages" around the pattern.
  const extra = bookPages - REQUIRED_NUMBERED_PAGES;
  let start = 1 + Math.floor(extra / 2);
  if (start % 2 === 0) start += 1; // must be odd
  // Ensure end fits in the book (rare edge if rounding pushes too far)
  while (start + ODD_SPAN > bookPages) start -= 2;
  if (start < 1) start = 1;
  if (start % 2 === 0) start = 1;
  return start;
}

function apply() {
  const height = document.getElementById('heightSel').value;
  document.getElementById('pillHeight').textContent = height + ' cm';

  if (height !== '19') {
    setMsg('bad', 'Only <b>19 cm</b> data is loaded right now. Send the 21 cm and 23 cm CSV files and I will add them.');
    clearTable();
    document.getElementById('kStart').textContent = '—';
    document.getElementById('kEnd').textContent = '—';
    document.getElementById('status').textContent = 'No data for this height.';
    return;
  }

  const pages = toInt(document.getElementById('bookPages').value);
  if (!Number.isFinite(pages)) {
    setMsg('bad', 'Please enter your <b>book total pages</b> (numbers only).');
    clearTable();
    document.getElementById('kStart').textContent = '—';
    document.getElementById('kEnd').textContent = '—';
    document.getElementById('status').textContent = 'Waiting for a valid number…';
    return;
  }
  if (pages < REQUIRED_NUMBERED_PAGES) {
    setMsg('bad', `This Heart pattern requires a book with at least <b>${REQUIRED_NUMBERED_PAGES}</b> pages. Your book has <b>${pages}</b>.`);
    clearTable();
    document.getElementById('kStart').textContent = '—';
    document.getElementById('kEnd').textContent = '—';
    document.getElementById('status').textContent = 'Book is too small.';
    return;
  }

  const startOdd = computeCenteredStart(pages);
  const endPage = startOdd + ODD_SPAN;

  document.getElementById('kStart').textContent = String(startOdd);
  document.getElementById('kEnd').textContent = String(endPage);

  renderTable(startOdd);

  setMsg('good', `OK. Your centered design will use odd pages from <b>${startOdd}</b> to <b>${endPage}</b>. Total folds: <b>${REQUIRED_FOLDS}</b>.`);
  document.getElementById('status').textContent = 'Table generated.';
}

function resetAll() {
  document.getElementById('bookPages').value = '';
  document.getElementById('kStart').textContent = '—';
  document.getElementById('kEnd').textContent = '—';
  clearTable();
  setMsg('', 'Enter your book page count and press <b>Apply</b>.');
  document.getElementById('status').textContent = 'Waiting for input…';
}

function downloadCSV() {
  const tbody = document.getElementById('tbody');
  if (!tbody.children.length) {
    alert('Please press Apply first to generate the table.');
    return;
  }
  const lines = [];
  lines.push('Fold,PageOdd,Mark1_cm,Mark2_cm');
  for (const tr of tbody.children) {
    const tds = tr.querySelectorAll('td');
    lines.push([tds[0].textContent, tds[1].textContent, tds[2].textContent, tds[3].textContent].join(','));
  }
  const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Heart_19cm_table.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

document.getElementById('applyBtn').addEventListener('click', apply);
document.getElementById('resetBtn').addEventListener('click', resetAll);
document.getElementById('printBtn').addEventListener('click', () => window.print());
document.getElementById('dlBtn').addEventListener('click', downloadCSV);

// initialize fixed KPIs
document.getElementById('kFolds').textContent = String(REQUIRED_FOLDS);
document.getElementById('kPagesNeeded').textContent = String(REQUIRED_NUMBERED_PAGES);
</script>
</body>
</html>
